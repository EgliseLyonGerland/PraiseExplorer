---
import clsx from "clsx";
import Layout from "@/layouts/Layout.astro";
import fetchSongs from "@/libs/loadSongs";

export async function getStaticPaths() {
  const songs = await fetchSongs();

  return songs.map((song) => ({
    params: { songId: song.id },
  }));
}

const { songId } = Astro.params;

const songs = await fetchSongs();
const song = songs.find((doc) => doc.id === songId);

if (!song) {
  return Astro.redirect("/");
}
---

<Layout title={song.title}>
  <div class="p-4 sm:p-8 md:p-12">
    <div class="space-y-2 mb-8">
      <h1 class="font-serif text-3xl sm:text-4xl">{song.title}</h1>
      <h2 class="opacity-60 text-xl">{song.authors || "Aucun auteur"}</h2>
      {song.copyright && <h3 class="opacity-40">Â© {song.copyright}</h3>}
    </div>

    <div class="flex flex-col gap-6 sm:gap-8 text-md sm:text-lg tracking-wide">
      {
        song.lyrics
          ? song.lyrics.map((part) => (
              <div
                class={clsx(
                  "whitespace-pre-line font-serif",
                  part.type === "chorus" && "pl-4 border-l-2 border-primary"
                )}
              >
                {part.text}
              </div>
            ))
          : "Aucune parole"
      }
    </div>
  </div>
</Layout>
